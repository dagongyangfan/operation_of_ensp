<!DOCTYPE html>
<html>
<head>
<title>ensp操作.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="%E7%AC%AC%E9%9B%B6%E7%AB%A0">第零章</h1>
<h2 id="%E5%B8%B8%E7%94%A8%E8%A7%86%E5%9B%BE">常用视图</h2>
<pre><code>用户视图&lt;Huawei&gt;  
系统视图[Huawei]  
接口视图
</code></pre>
<h2 id="%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4">常用指令</h2>
<pre class="hljs"><code><div>&lt;Huawei&gt;undo terminal monitor    //关闭日志，以获取更好的显示
&lt;Huawei&gt;sys                      //进入系统视图
[Huawei]sysname xxx              //更改设备名
</div></code></pre>
<h1 id="%E7%AC%AC%E4%B8%80%E7%AB%A0%E4%BD%BF%E7%94%A8telnet%E6%96%B9%E5%BC%8F%E7%99%BB%E5%BD%95%E4%BA%A4%E6%8D%A2%E6%9C%BA">第一章：使用telnet方式登录交换机</h1>
<h2 id="1-ipv4%E7%8E%AF%E5%A2%83">1. IPv4环境</h2>
<h3 id="%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%93%8D%E4%BD%9C">交换机操作</h3>
<pre class="hljs"><code><div>&lt;sw&gt;sys  
[sw]int vlanif 1  
[sw-vlanif1]ip add x.x.x.x xx  

//配置用户远程登录（模式）口令和权限
//使能服务器功能
&lt;sw&gt;sys
[sw]telnet server enable
[sw]telnet server-source-i vlanif 1

// 配置VTY用户界面的支持协议类型
[sw]user-int vty 0 4
[sw-ui-vty0-4]protocol inbound telnet      //指定VTY用户界面所支持的协议为telnet

// 配置VTY用户界面的认证方式为password
[sw-ui-vty0-4]authentication-mode password
[sw-ui-vty0-4]set authentication password simple xxx      
[sw-ui-vty0-4]user privilege level 15
</div></code></pre>
<h3 id="pc%E6%9C%BA%E6%93%8D%E4%BD%9C">PC机操作</h3>
<pre class="hljs"><code><div>// ensp中PC机不支持Telnet功能，因此使用交换机代替PC机进行实验
&lt;pc&gt;sys
[pc]int vlanif 1
[pc-vlanif1]ip add x.x.x.x xx  //与交换机配置在同一网段

// 在用户视图下执行telnet命令
&lt;pc&gt;telnet x.x.x.x
// 按照提示输入密码
</div></code></pre>
<h2 id="2-ipv6">2. IPv6</h2>
<h3 id="%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%93%8D%E4%BD%9C">交换机操作</h3>
<pre class="hljs"><code><div>&lt;sw&gt;sys
[sw]ipv6                        //全局使能ipv6
[sw]int Vlanif 1
[sw-Vlanif1]ipv6 enable         //vlanif视图下使能ipv6
[sw-Vlanif1]ipv6 add ...
[sw-Vlanif1]quit
[sw]telnet server enable
[sw]telnet server-source-i vlanif 1
[sw]user-int vty 0 4
[sw-ui-vty0-4]protocol inbound telnet
[sw-ui-vty0-4]authentication-mode password 
[sw-ui-vty0-4]set authentication password simple ...
[sw-ui-vty0-4]user privilege level 15
</div></code></pre>
<h3 id="pc%E6%9C%BA%E6%93%8D%E4%BD%9C">PC机操作</h3>
<pre class="hljs"><code><div>&lt;pc&gt;sys
[pc]ipv6
[pc]int Vlanif 1
[pc-Vlanif1]ipv6 enable 
[pc-Vlanif1]ipv6 address ...    //与交换机同一网段
[pc-Vlanif1]return
&lt;pc&gt;telnet ipv6 ...             //telnet命令后必须标明使用ipv6 
</div></code></pre>
<h1 id="%E7%AC%AC%E4%BA%8C%E7%AB%A0%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%AB%AF%E5%8F%A3%E9%85%8D%E7%BD%AE">第二章：交换机端口配置</h1>
<h2 id="%E7%AB%AF%E5%8F%A3%E7%B1%BB%E5%9E%8B%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4">端口类型配置命令</h2>
<pre class="hljs"><code><div>[sw-GigabitEthernet0/0/1] mdi { normal | cross | auto }
// normal ： MDI-X 端口
// cross ： MDI 端口
// automdix ： 自适应
</div></code></pre>
<h2 id="%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4">流量控制配置命令</h2>
<pre class="hljs"><code><div>[sw-GigabitEthernet0/0/1] flow-control
[sw-GigabitEthernet0/0/1] undo flow-control
// 华为系列交换机所有端口在缺省情况下都禁用了流量控制功能
</div></code></pre>
<h2 id="%E7%AB%AF%E5%8F%A3%E8%81%9A%E5%90%88%E9%85%8D%E7%BD%AE">端口聚合配置</h2>
<pre class="hljs"><code><div>// 创建（删除）聚合接口（逻辑），并进入聚合接口视图
[sw]int eth-trunk X   //X：聚合端口号，取值范围为0-63）
[sw]undo int eth-trunk X

// 配置手工负载分担模式
[sw-Eth-TrunkX]mode manual load-balance 

// 在聚合接口视图下,向聚合接口中加入（删除）成员接口
[sw-Eth-TrunkX]trunkport int-type interface-number1 [ to interface-number2 ]     // int-type：端口类型
    eg.[sw-Eth-TrunkX]trunkport g 0/0/1 to 0/0/5
[sw-Eth-TrunkX]undo trunkport int-type interface-number1 [ to interface-number2 ]
    eg.[sw-Eth-TrunkX]undo trunkport g 0/0/1 to 0/0/5

// 在以太网接口视图下将接口0/0/X加入（退出）聚合组
[sw-GigabitEthernet0/0/X]eth-trunk trunk-id 
[sw-GigabitEthernet0/0/X]undo eth-trunk trunk-id 

// 查看Eth-Trunk的成员接口信息
&lt;sw&gt;display trunkmembership eth-trunk 
查看Eth-Trunk接口的配置信息
&lt;sw&gt;display eth-trunk trunk-id [ interface interface-type interface-number | verbose ]  // verbose查看Eth-Trunk接口的详细配置信息
</div></code></pre>
<h1 id="%E7%AC%AC%E4%B8%89%E7%AB%A0%E7%94%9F%E6%88%90%E6%A0%91%E5%8D%8F%E8%AE%AE">第三章：生成树协议</h1>
<p>STP/RSTP需要通过BPDU报文交互来完成生成树计算。因此，需先在要参与生成树计算的接口下使用bpdu enable命令使能上送BPDU报文到CPU处理的功能</p>
<pre class="hljs"><code><div>[sw-GigabitEthernet0/0/X]bpdu enable
</div></code></pre>
<h2 id="%E5%90%AF%E5%8A%A8%E5%85%B3%E9%97%AD%E7%94%9F%E6%88%90%E6%A0%91%E5%8D%8F%E8%AE%AE">启动/关闭生成树协议</h2>
<pre class="hljs"><code><div>// 全局
[sw]stp  enable
[sw]undo stp  enable 或 stp disable

// 接口
[sw-GigabitEthernet0/0/X]stp enable
[sw-GigabitEthernet0/0/X]undo stp enable
</div></code></pre>
<h2 id="%E8%AE%BE%E5%AE%9A%E7%BD%91%E6%A1%A5%E4%BC%98%E5%85%88%E7%BA%A7">设定网桥优先级</h2>
<p>如果网络中的所有交换机都在缺省配置下，根据BPDU比较原则，MAC地址最小的交换机被选为根桥，但是该交换机未必是理想的根桥，可以通过命令配置Bridge Priority将合适的交换机推举为根桥</p>
<pre class="hljs"><code><div>[sw]stp priority bridge-priority
//bridge-priority：用来标识所设定的bridge 优先级，该值是不连续的，范围为0～61440，步长为4096。缺省情况下，交换机的优先级为32768。

[sw]undo stp priority    // 恢复为缺省值
</div></code></pre>
<h2 id="%E8%AE%BE%E5%AE%9A%E7%AB%AF%E5%8F%A3%E4%BC%98%E5%85%88%E7%BA%A7">设定端口优先级</h2>
<pre class="hljs"><code><div>[sw-GigabitEthernet0/0/1] stp port priority port-priority
//port-priority：用来标识所设定的优先级，该值是不连续的，范围为0～240，步长为16。缺省情况下，端口优先级为128。
[sw-GigabitEthernet0/0/1] undo stp port priority
</div></code></pre>
<h2 id="%E8%AE%BE%E5%AE%9A%E7%AB%AF%E5%8F%A3%E5%BC%80%E9%94%80">设定端口开销</h2>
<pre class="hljs"><code><div>[sw-GigabitEthernet0/0/1] stp cost X 
// X：用来标识所设定的路径开销值，范围1～200000。缺省情况下，网桥根据与端口相连的链路速率而直接得到端口的路径开销。
[sw-GigabitEthernet1/0/1] undo stp cost
</div></code></pre>
<h2 id="%E6%98%BE%E7%A4%BA%E7%94%9F%E6%88%90%E6%A0%91%E5%8D%8F%E8%AE%AE%E4%BF%A1%E6%81%AF">显示生成树协议信息</h2>
<pre class="hljs"><code><div>[任意视图] display stp   [ brief ]
</div></code></pre>
<h1 id="%E7%AC%AC%E5%9B%9B%E7%AB%A0%E4%BA%A4%E6%8D%A2%E6%9C%BAvlan%E9%85%8D%E7%BD%AE">第四章：交换机VLAN配置</h1>
<h2 id="vlan%E4%B8%AD%E9%93%BE%E8%B7%AF%E7%B1%BB%E5%9E%8B">VLAN中链路类型：</h2>
<h3 id="1-%E6%8E%A5%E5%85%A5%E9%93%BE%E8%B7%AFaccess-link">1. 接入链路（Access Link）</h3>
<p>用于连接用户主机和交换机的链路。通常情况下，主机并不需要知道自己属于哪个VLAN，主机硬件通常也不能识别带有VLAN标记的帧。因此，主机发送和接收的帧都是untagged帧。</p>
<h3 id="2-%E5%B9%B2%E9%81%93%E9%93%BE%E8%B7%AFtrunk-link">2. 干道链路（Trunk Link）</h3>
<p>用于交换机间的互连或交换机与路由器之间的连接。干道链路可以承载多个不同VLAN数据，数据帧在干道链路传输时，干道链路的两端设备需要能够识别数据帧属于哪个VLAN，所以在干道链路上传输的帧都是Tagged帧。</p>
<h2 id="vlan%E4%B8%AD%E7%AB%AF%E5%8F%A3%E7%B1%BB%E5%9E%8B">VLAN中端口类型</h2>
<h3 id="1-%E6%8E%A5%E5%85%A5%E7%AB%AF%E5%8F%A3access-port">1. 接入端口（Access Port）</h3>
<p>一般用于接入链路，且发送/接收不带有VLAN标签的帧（untagged frames）。如果Access接口配置了缺省VLAN，则在该报文（指接收的报文）上加上Tag标记，并将Tag中的VID字段的值设置为接口所属的缺省VLAN编号，此时接入链路上允许与缺省VLAN Tag匹配的以太网帧（不带标签）通过。
只能属于一个VLAN
主要用来连接用户主机</p>
<h3 id="2-%E9%AA%A8%E5%B9%B2%E7%AB%AF%E5%8F%A3trunk-port">2. 骨干端口（Trunk Port）</h3>
<p>一般用于骨干链路，发送/接收带有VLAN标签的帧（tagged frames），但VLAN ID与Trunk Link的缺省VLAN ID相同的帧除外。
允许多个VLAN的帧通过
主要用来连接其它交换机设备</p>
<h3 id="3-%E6%B7%B7%E5%90%88%E7%AB%AF%E5%8F%A3hybrid-port">3. 混合端口（Hybrid Port）</h3>
<p>既可以用于接入链路也可以用于干道链路，既可以发送/接收带有VLAN标签的帧，也可以发送/接收不带有VLAN标签的帧
允许多个VLAN的帧通过，并可以配置在出接口方向是否将VLAN帧的Tag剥掉
既可以用来连接用户主机也可以用来连接其它交换机设备</p>
<h2 id="%E5%88%9B%E5%BB%BA%E5%88%A0%E9%99%A4vlan">创建/删除VLAN</h2>
<pre class="hljs"><code><div>[sw]vlan X  //X是vlan的id,取值范围为1～4094
[sw]undo vlan X
</div></code></pre>
<h2 id="%E9%85%8D%E7%BD%AE%E4%BA%8C%E5%B1%82%E4%BB%A5%E5%A4%AA%E7%BD%91%E7%AB%AF%E5%8F%A3%E7%B1%BB%E5%9E%8B">配置二层以太网端口类型</h2>
<pre class="hljs"><code><div>[sw-GigabitEthernet0/0/X]port link-type { access | trunk | hybrid }
//恢复为缺省值命令：
[sw-GigabitEthernet0/0/X]undo port link-type
</div></code></pre>
<h2 id="%E5%85%B3%E8%81%94vlan%E5%92%8C%E7%AB%AF%E5%8F%A3access%E7%AB%AF%E5%8F%A3">关联VLAN和端口(Access端口)</h2>
<h3 id="1-vlan%E8%A7%86%E5%9B%BE%E4%B8%8B">1. vlan视图下</h3>
<pre class="hljs"><code><div>[sw-vlanX]port int-type { interface-number1 [ to interface-number2 ] } 
[sw-vlanX]undo port int-type { interface-number1 [ to interface-number2 ] } 
    eg.[sw-vlan2] port g 0/0/1 to g 0/0/12
</div></code></pre>
<h3 id="2-%E7%AB%AF%E5%8F%A3%E7%BB%84%E8%A7%86%E5%9B%BE%E4%B8%8B">2. 端口组视图下</h3>
<pre class="hljs"><code><div>[sw]port-group 1to12
[sw-port-group-1to12]group-member g 0/0/1 to g 0/0/12
[sw-port-group-1to12]port link-type access
[sw-port-group-1to12]port default vlan 2 
[sw-port-group-1to12]undo port default vlan 2 
</div></code></pre>
<h2 id="%E5%85%B3%E8%81%94%E7%AB%AF%E5%8F%A3%E5%92%8Cvlantrunk%E7%AB%AF%E5%8F%A3">关联端口和VLAN（Trunk端口）</h2>
<pre class="hljs"><code><div>// 允许某些VLAN的帧能通过当前Trunk端口：
[sw-GigabitEthernet0/0/X]port trunk allow-pass vlan { vlan_id_list | all }
// vlan_id_list: vlan_id1 [to vlan_id2]
// 将当前Trunk端口从某些VLAN中删除：
[sw-GigabitEthernet0/0/X]undo port trunk allow-pass vlan { vlan_id_list | all }
</div></code></pre>
<h1 id="%E7%AC%AC%E4%BA%94%E7%AB%A0telnet%E6%96%B9%E5%BC%8F%E7%99%BB%E5%BD%95%E8%B7%AF%E7%94%B1%E5%99%A8">第五章：telnet方式登录路由器</h1>
<h2 id="1-ipv4%E7%8E%AF%E5%A2%83">1. IPv4环境</h2>
<h3 id="%E8%B7%AF%E7%94%B1%E5%99%A8%E9%85%8D%E7%BD%AE">路由器配置</h3>
<pre class="hljs"><code><div>// 设置AAA认证
[sw]user-interface vty 0 4
[sw-ui-vty0-4]authentication-mode aaa       // 设置用户认证方式为AAA认证
[sw-ui-vty0-4]quit
[sw]aaa         // 进入aaa视图
//创建本地用户，并配置对应的登录密码
[sw-aaa]local-user user-name password { cipher | irreversible-cipher } xxx      //xxx是用户密码
    eg.[sw-aaa]local-user yf password cipher 123456
//配置本地用户的接入类型为Telnet用户
[Huawei-aaa]local-user user-name service-type telnet
[Huawei-aaa]local-user hui privilege level 15

//进入接口视图配置IPv4地址
</div></code></pre>
<h3 id="pc%E6%9C%BA%E6%93%8D%E4%BD%9C">PC机操作</h3>
<pre class="hljs"><code><div>// ensp中PC机不支持Telnet功能，因此使用交换机代替PC机进行实验
&lt;pc&gt;sys
[pc]int vlanif 1
[pc-vlanif1]ip add x.x.x.x xx  //与直连路由器的接口配置在同一网段

// 在用户视图下执行telnet命令
&lt;pc&gt;telnet x.x.x.x
// 按照提示输入用户名、密码
</div></code></pre>
<h2 id="2-ipv6%E7%8E%AF%E5%A2%83">2. IPv6环境</h2>
<h1 id="%E7%AC%AC%E5%85%AD%E7%AB%A0%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1%E8%A1%A8">第六章：配置路由表</h1>
<h2 id="1-%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1">1. 静态路由</h2>
<h3 id="ipv4%E7%8E%AF%E5%A2%83">IPv4环境</h3>
<pre class="hljs"><code><div>&lt;RT&gt;sys
[RT]ip route-static x.x.x.x xx x.x.x.x（目的地址、掩码长度/掩码、下一跳地址）
！！！缺省路由/默认路由
[RT]ip route-static 0.0.0.0 0 x.x.x.x
</div></code></pre>
<h3 id="ipv6%E7%8E%AF%E5%A2%83">IPv6环境</h3>
<pre class="hljs"><code><div>&lt;RT&gt;sys
[RT]ipv6
[RT]ipv6 route-static ...
</div></code></pre>
<h2 id="2-rip">2. RIP</h2>
<p>在路由器中开启RIP协议后还需要将特定接口/网段与RIP关联<br>
即将我们希望使用RIP的接口及其所在网段加入本机的RIP协议工作网段中<br>
<strong>一个接口仅能和一个RIP进程关联</strong></p>
<h3 id="%E9%85%8D%E7%BD%AErip%E7%89%88%E6%9C%AC">配置RIP版本</h3>
<p>用户可以在RIP视图下配置RIP版本，也可在接口上配置RIP版本：<br>
当全局和接口都没有进行RIP版本配置时，接口发送RIP-1广播报文，可以接收RIP-1广播/单播报文、RIP-2广播/组播/单播报文。<br>
如果接口上配置了RIP版本，以接口配置的为准；如果接口没有进行RIP版本配置，接口运行的RIP版本将以全局配置的版本为准</p>
<pre class="hljs"><code><div>// 指定接口的版本为RIP-1  
[sw-Serial1/0] rip version 1  
// 指定接口的版本为RIP-2  
[sw-Serial1/0] rip version 2 [broadcast | multicast]  
// 配置全局RIP版本  
[sw-RIP-1] version { 1 | 2 }
</div></code></pre>
<h3 id="%E5%90%AF%E5%8A%A8%E5%85%B3%E9%97%AD%E6%B0%B4%E5%B9%B3%E5%88%86%E5%89%B2">启动/关闭水平分割</h3>
<pre class="hljs"><code><div>[sw-Serial1/0/0]rip split-horizon
[sw-Serial1/0/0]undo rip split-horizon
</div></code></pre>
<h3 id="ipv4%E7%8E%AF%E5%A2%83rip">IPv4环境（RIP）</h3>
<pre class="hljs"><code><div>&lt;RT&gt;sys
[RT]rip
[RT-rip-1]net x.x.x.x   //本机接口所在网段（不是本机接口IP地址）
</div></code></pre>
<h3 id="ipv6%E7%8E%AF%E5%A2%83ripng">IPv6环境（RIPng）</h3>
<p>与IPv4环境区别在于，IPv6环境只能通过让接口使能RIPng将接口与本机RIPng进程关联，无法直接指定网段</p>
<pre class="hljs"><code><div>&lt;RT&gt;sys
[RT]ipv6           //全局使能ipv6
[RT]ripng 1        //启动RIPng进程
[RT]int g 0/0/0
[RT-g0/0/0]ipv6 enable      //接口使能ipv6
[RT-g0/0/0]ipv6 add ...
[RT-g0/0/0]ripng 1 enable   //接口与RIPng 1 进程关联
</div></code></pre>
<h2 id="3-ospf">3. OSPF</h2>
<h3 id="%E5%88%9B%E5%BB%BA%E5%85%B3%E9%97%ADospf%E8%BF%9B%E7%A8%8B">创建/关闭OSPF进程</h3>
<p>process-id 为进程号，缺省值为1。路由器支持OSPF多进程，可以根据业务类型划分不同的进程。进程号是本地概念，不影响与其它路由器之间的报文交换。因此，不同的路由器之间，即使进程号不同也可以进行报文交换。</p>
<pre class="hljs"><code><div>[RT]ospf process-id
[RT]undo ospf process-id
</div></code></pre>
<h3 id="%E9%85%8D%E7%BD%AE%E8%B7%AF%E7%94%B1%E5%99%A8id">配置路由器id</h3>
<p>（1）<strong><font color="red">不论IPv4还是IPv6</font></strong>，路由器的ID号都是一个32比特的无符号整数，为点分十进制格式，它是路由器所在自治系统中的唯一标识。<br>
（2）如果路由器所有的接口都没有配置IP地址，那么用户必须配置路由器ID号，否则OSPF无法运行。</p>
<pre class="hljs"><code><div>[RT]router-id X     //X为路由器的ID号。
</div></code></pre>
<p>缺省情况下，路由器系统会从当前接口的IP地址中自动选取一个最大值作为Router ID。手动配置Router ID时，必须保证自治系统中任意两台Router ID都不相同。通常的做法是将Router ID配置为与该设备某个接口的IP地址一致，这样便可以保证它的唯一性。</p>
<h3 id="%E5%88%A0%E9%99%A4%E5%88%9B%E5%BB%BA%E5%8C%BA%E5%9F%9F">删除/创建区域</h3>
<pre class="hljs"><code><div>[sw-ospf-1]area 0
[sw-ospf-1]undo area 0          //区域默认是32位表示
</div></code></pre>
<h3 id="%E5%9C%A8%E5%8C%BA%E5%9F%9F%E4%B8%AD%E6%8C%87%E5%AE%9A%E7%BD%91%E6%AE%B5">在区域中指定网段</h3>
<pre class="hljs"><code><div>[sw-ospf-1-area-0.0.0.0]net x.x.x.x y.y.y.y(前者是网段地址/接口地址、后者是子网掩码反码)
[sw-ospf-1]undo area 0
</div></code></pre>
<h3 id="%E5%9C%A8%E6%8E%A5%E5%8F%A3%E4%B8%8A%E4%BD%BF%E8%83%BDospffont-color%22red%22%E4%BD%86%E6%98%AF%E5%BF%85%E9%A1%BB%E5%85%88%E5%88%9B%E5%BB%BAospf%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%8C%BA%E5%9F%9Ffont">在接口上使能OSPF<font color="red">（但是必须先创建OSPF进程和区域）</font></h3>
<pre class="hljs"><code><div>[RT-g0/0/0]ospf enable process-id area area-id
    eg.[RT-g0/0/0]ospf enable 1 area 0
</div></code></pre>
<h3 id="ipv4%E7%8E%AF%E5%A2%83ospf">IPv4环境（OSPF）</h3>
<pre class="hljs"><code><div>//在端口视图下加入OSPF
&lt;RT&gt;sys
[RT]ospf 1 route-id 1.1.1.1
[RT]area 0
[sw-ospf-1-area-0.0.0.0]quit
[RT]int g 0/0/0
[RT-GigabitEthernet0/0/0]ospf enable 1 area 0

//在area视图下加入OSPF
&lt;RT&gt;sys
[RT]ospf 1 route-id 1.1.1.1
[RT]area 0
[RT-ospf-1-area-0.0.0.0]net x.x.x.x y.y.y.y(前者是网段地址/接口地址、后者是子网掩码反码)
</div></code></pre>
<h3 id="ipv6%E7%8E%AF%E5%A2%83ospfv3">IPv6环境（OSPFv3）</h3>
<pre class="hljs"><code><div>&lt;RT&gt;sys
[RT]ospfv3 1
[RT]route-if 1.1.1.1
[RT]area 0
[sw-ospf-1-area-0.0.0.0]quit
[RT]int g 0/0/0
[RT-GigabitEthernet0/0/0]ospfv3 1 area 0
</div></code></pre>
<h2 id="4-%E8%B7%AF%E7%94%B1%E5%BC%95%E5%85%A5">4. 路由引入</h2>
<p>在缺省情况下，各路由协议不引入其它协议的路由。可以引入其他进程或其他协议学到的路由信息，从而丰富路由表项。</p>
<pre class="hljs"><code><div>[RT]ripng 1
[RT-ripng-1]import-route {direct | ospfv3 | static}
[RT]ospfv3 1
[RT-ospfv3-1]import-route {direct | ripng | static}
</div></code></pre>
<h1 id="%E7%AC%AC%E4%B8%83%E7%AB%A0ipv6%E5%9F%BA%E7%A1%80">第七章：IPv6基础</h1>
<h2 id="1-%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AEipv6%E5%9C%B0%E5%9D%80">1. 手动配置IPv6地址</h2>
<pre class="hljs"><code><div>&lt;RT&gt;sys
[RT]ipv6           //全局使能ipv6
[RT]int g 0/0/0
[RT-g0/0/0]ipv6 enable      //接口使能ipv6
[RT-g0/0/0]ipv6 add ...
</div></code></pre>
<h2 id="2-%E6%9C%89%E7%8A%B6%E6%80%81%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AEdhcp">2. 有状态自动配置（DHCP）</h2>
<pre class="hljs"><code><div>&lt;RT&gt;sys
[RT]ipv6 
[RT]dhcp enable	            //全局使能DHCP
[RT]dhcpv6 pool pool1       //建立地址池
[RT-dhcpv6-pool-pool1]address prefix FC00:2::/64        //配置地址池网段
[RT-dhcpv6-pool-pool1]excluded-address FC00:2::1        //从地址池中将固定分配给路由器接口IP地址去除
[RT-dhcpv6-pool-pool1]quit
[RT]int GigabitEthernet 0/0/9
[RT-GigabitEthernet0/0/9]ipv6 enable 
[RT-GigabitEthernet0/0/9]ipv6 address FC00:2::1 64
[RT-GigabitEthernet0/0/9]dhcpv6 server pool1            //将接口与地址池绑定
[RT-GigabitEthernet0/0/9]undo ipv6 nd ra halt
[RT-GigabitEthernet0/0/9]ipv6 nd autoconfig managed-address-flag  //此命令用来设置RA报文中的有状态自动配置地址的标志位, 如果设置了该标志位，则PC可以通过DHCPv6有状态自动分配方式获得IPv6地址。
</div></code></pre>
<h2 id="3-%E6%97%A0%E7%8A%B6%E6%80%81%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AEslaac">3. 无状态自动配置（SLAAC）</h2>
<pre class="hljs"><code><div>&lt;RT&gt;sys
[R1]ipv6 
[R1]int GigabitEthernet 0/0/9
[R1-GigabitEthernet0/0/9]ipv6 enable 
[R1-GigabitEthernet0/0/9]ipv6 addres FC00:1::1 64
[R1-GigabitEthernet0/0/9]undo ipv6 nd ra halt       // 此命令用于激活接口发布RA报文的功能
[R1-GigabitEthernet0/0/9]quit
</div></code></pre>
<h1 id="%E7%AC%AC%E5%85%AB%E7%AB%A0acl%E9%85%8D%E7%BD%AE%E5%92%8Cnat%E9%85%8D%E7%BD%AE">第八章：ACL配置和NAT配置</h1>
<h2 id="acl">ACL</h2>
<p>ACl可以在路由器接口的输入(inbound)和输出(outbound)两个方向上对IP包进行过滤</p>
<p><img src="file:///e:/111学习/3.1大三上/网络综合实验/operation_of_ensp/image/ACL类型.png" alt="ACL类型"></p>
<h3 id="ipv4%E7%8E%AF%E5%A2%83%E4%B8%8Bacl%E9%85%8D%E7%BD%AE">IPv4环境下ACL配置</h3>
<pre class="hljs"><code><div>//创建ACL
[RT]acl acl-number [ match-order { config | auto } ] 
//config：匹配规则时按用户的配置顺序。 
//auto：匹配规则时按“深度优先”的顺序。
//acl-number需要遵守ACL类型的需求，不同的类型对应指令以及过滤能力不同

//ACL规则配置
[RT-acl-basic-2000]rule [rule-id] {permit | deny} [source sour-addr sour-wildcard | any] [time-range time-name]
//sour-wildcard：源地址掩码反码
//基本ACL只允许对源地址进行过滤，不允许对目的地址过滤

[RT-acl-adv-3000]rule [rule-id] {permit | deny} protocol [source sour-addr sour-wildcard | any] [ destination dest-addr dest-wildcard | any] [ source-port operator port1 [ port2 ] ] [ destination-port operator port1 [ port2 ] ] [ icmp-type { icmp-message | icmp-type icmp-code} ] [ time-range time-name ]
//protocol : ip, ospf, igmp, gre, icmp, tcp, udp, etc. 
//高级ACL允许同时对源地址、目的地址、协议以及端口进行过滤

//在接口上应用ACL规则
[RT-Serial1/0/0]traffic-filter {inbound | outbound} acl {acl-number | name acl-name}
//inbound和outbound一定要区分清楚

//显示ACL的配置及运行情况
[任意视图]dis acl {all | acl-number}
//显示设备上所有基于ACL进行报文过滤的应用信息
[任意视图]dis traffic-filter applied-record
//显示指定接口上基于ACL进行报文过滤的流量统计信息
[任意视图]dis traffic-filter statistics int interface-type interface-number {inbound | outbound}
</div></code></pre>
<h3 id="ipv6%E7%8E%AF%E5%A2%83%E4%B8%8Bacl%E9%85%8D%E7%BD%AE">IPv6环境下ACL配置</h3>
<pre class="hljs"><code><div>[RT]acl ipv6 3000
[...]rule deny ipv6 source fc00:0::1 128 destination fc00:2::1 128
[...]quit
[RT]int g 0/0/0
[...]traffic-filter inbound ipv6 acl 3000
//IPV6环境下不使用掩码的反码，而是直接使用掩码/掩码长度
</div></code></pre>
<h2 id="nat">NAT</h2>
<h3 id="ipv4%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%85%8D%E7%BD%AEnat">IPv4环境下配置NAT</h3>
<p>NAT有两种实现方式：<br>
1. 定义地址池<br>
当内部网络有数据包要发往外部网络时，首先根据该ACL判定是否是允许的数据包，<br>
然后再根据定义的关联找到与之对应的地址池，最后再把源地址转换成这个地址池中的某一个地址<br>
2. 直接将内网地址映射到NAT路由器的接口上<br>
接口与ACL的关联又称EASY IP 特性，它是指在地址转换的过程中直接使用接口的IP地址作为转换后的源地址</p>
<pre class="hljs"><code><div>//定义地址池
[RT]nat address-group group-index start-address end-address
    eg.[RT]nat address-group 1 address 210.30.101.1 210.30.101.4
//定义地址池与ACL的关联
[RT-Serial1/0/0]nat outbound acl-number address-group group-index 
    eg.[RT]acl 2000 match-order auto
       [RT-acl-basic-2000]rule permit source 192.168.1.0 0.0.0.255
       [RT-acl-basic-2000]rule deny source any
       [RT]nat address-group 1 address 210.30.101.1 210.30.101.4
       [RT-Serial1/0/0]nat outbound 2000 address-group 1
    
//定义接口与ACL的关联
[RT-Serial1/0/0]nat outbound 2000
    eg.[RT]acl 2000 match-order auto
       [RT-acl-basic-2000]rule permit source 192.168.1.0 0.0.0.255
       [RT-acl-basic-2000]rule deny source any
       [RT-Serial1/0]nat outbound 2000
</div></code></pre>
<p>用户可将内部服务器的IP地址和端口号映射到NAT路由器的外部地址以及端口号上，从而实现由外部网络访问内部服务器的功能。</p>
<pre class="hljs"><code><div>//建立地址池映射命令：
[RT-Serial1/0/0]nat server protocol {protocol-number | icmp | tcp | udp} global global-addr { global-port | any | domain | ftp | pop3 | smtp | telnet | www } inside local-addr { local-port | any | domain | ftp | pop3 | smtp | telnet | www }
    eg.[RT-Serial1/0/0]nat server protocol tcp global 210.30.103.22 8080 inside 192.168.1.4 www

//建立接口映射命令
[RT-Serial1/0/0]nat server protocol {protocol-number | icmp | tcp | udp} global current-int { global-port | any | domain | ftp | pop3 | smtp | telnet | www } inside local-addr { local-port | any | domain | ftp | pop3 | smtp | telnet | www }
!!!如果想借用接口地址作为转换后的外网地址，可以配置参数current-interface或者loopback
</div></code></pre>
<p>一般情况下，NAT只能对IP报文头的IP地址和TCP/UDP头部的端口信息进行转换。<br>
对于一些特殊协议，例如DNS、FTP等，它们报文的数据部分可能包含IP地址或端口信息，这些内容不能被NAT有效的转换，从而无法正确完成通信。<br>
使能ALG(Application Level Gateway)功能可以使NAT设备识别被封装在报文数据部分的IP地址或端口信息，并根据映射表项
进行替换，实现报文正常穿越NAT。</p>
<pre class="hljs"><code><div>[RT]nat alg ftp enable
</div></code></pre>

</body>
</html>
